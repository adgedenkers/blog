{
    "_id": "583da115697842a1f86bd2ed69000af0",
    "published": true,
    "type": "blogpost",
    "pubdate": "Thu, 15 Oct 2009 13:53:53 +0100",
    "title": "Erlang map/reduce in CouchDB",
    "slug": "erlang_map_reduce_in_couchdb",
    "intro": "After some initial confusion on my part, it appears that a native Erlang view server has made the 0.10.0 release of CouchDB. Unfortunately, at the time of writing, there is no documentation on enabling or using this feature. The only example currently available is in the test suite, so for anyone else wanting to play around with Erlang map/reduce functions, these are the steps I carried out on Ubuntu Jaunty...",
    "markdown": "After some initial confusion on my part, it appears that a native Erlang view server has made the 0.10.0 release of CouchDB. Unfortunately, at the time of writing, there is no documentation on enabling or using this feature. The only example currently available is in the test suite, so for anyone else wanting to play around with Erlang map/reduce functions, these are the steps I carried out on Ubuntu Jaunty...\n\nFirst, you'll need to edit your local.ini to include a native query servers section:\n\n<pre><code class=\"ini\">[native_query_servers]\nerlang = {couch_native_process, start_link, []}</code></pre>\n\nYour local.ini will most likely be at **/usr/local/etc/couchdb/local.ini** or **/etc/couchdb/local.ini**. To see these changes you will also need to restart the server:\n\n<pre><code class=\"no-highlight\">sudo /etc/init.d/couchdb restart</code></pre>\n\nTo test out using Erlang views, visit the Futon admin interface, create a new database and open a temporary view. You should now be able to select erlang from the language drop-down. Let's try an example of map/reduce functions which count the total documents at each number of revisions (there are x many documents at version \"1\", and y documents at \"2\"... etc). Add a few documents to the database, then enter the following functions as a temporary view:\n\n<pre><code class=\"no-highlight\">%% Map Function\nfun({Doc}) ->\n<<K,_/binary>> = proplists:get_value(<<\"_rev\">>, Doc, null),\nV = proplists:get_value(<<\"_id\">>, Doc, null),\nEmit(<<K>>, V)\nend.\n\n%% Reduce Function\nfun(Keys, Values, ReReduce) -> length(Values) end.</code></pre>\n\nIf all has gone well, you should see a list of the total number of documents at each revision number. Have fun!\n\n**Edit**: I've now added this to the [CouchDB wiki](http://wiki.apache.org/couchdb/EnableErlangViews)."
}
